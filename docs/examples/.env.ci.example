# Shopify Nano-SRE - CI/CD Configuration
# Use this configuration for GitHub Actions, GitLab CI, Jenkins, etc.

# ============================================
# STORE CONFIGURATION
# ============================================

# Required: Your Shopify store URL
# CI/CD: Use repository secrets/variables
# GitHub Actions: ${{ secrets.STORE_URL }}
# GitLab CI: $STORE_URL
STORE_URL=https://your-store.myshopify.com

# Optional: Shopify Admin API key
# Should be stored as a secret in your CI/CD platform
SHOPIFY_ADMIN_API_KEY=

# ============================================
# LLM CONFIGURATION
# ============================================

# LLM Provider
# Recommended for CI: openai or anthropic (predictable, fast)
LLM_PROVIDER=openai

# API key - MUST be stored as a CI/CD secret
# GitHub Actions: ${{ secrets.LLM_API_KEY }}
# GitLab CI: $LLM_API_KEY (masked variable)
# Jenkins: credentials('llm-api-key')
LLM_API_KEY=

# Model name
# For CI: Use faster models to reduce pipeline time
# OpenAI: gpt-3.5-turbo (faster, cheaper) or gpt-4 (better quality)
# Anthropic: claude-3-haiku (fast) or claude-3-sonnet (balanced)
LLM_MODEL=gpt-3.5-turbo

# ============================================
# ALERTING
# ============================================

# Webhook URL for CI/CD alerts
# Recommended: Send to team channel (Slack, Discord, Teams)
# Store as secret in CI/CD platform
ALERT_WEBHOOK_URL=

# ============================================
# CI/CD SETTINGS
# ============================================

# Disable continuous monitoring in CI
# CI should run one-off checks, not watch mode
CHECK_INTERVAL_MINUTES=0

# Database path (ephemeral in CI)
# Results will be in artifacts, not persistent storage
SQLITE_DB_PATH=/tmp/nano_sre_ci.db

# ============================================
# PRIVACY & SECURITY
# ============================================

# Disable PII redaction in CI for better debugging
# Enable if sharing artifacts publicly
REDACT_PII=false

# Disable screenshot blurring in CI
SCREENSHOT_BLUR_ENABLED=false

# ============================================
# PERFORMANCE SETTINGS
# ============================================

# Log level - INFO for cleaner CI logs
LOG_LEVEL=INFO

# Always headless in CI
HEADLESS=true

# Standard viewport for consistency
VIEWPORT_WIDTH=1920
VIEWPORT_HEIGHT=1080

# ============================================
# PLAYWRIGHT SETTINGS
# ============================================

# Browser to use in CI
# Chromium is fastest and most reliable in CI environments
BROWSER=chromium

# Disable video recording in CI to save time/space
RECORD_VIDEO=false

# Enable trace only on failure (for debugging)
RECORD_TRACE=false

# ============================================
# TIMEOUT SETTINGS
# ============================================

# Page load timeout (ms)
# CI environments may be slower, increase if needed
PAGE_TIMEOUT=60000

# Navigation timeout (ms)
NAVIGATION_TIMEOUT=60000

# Overall check timeout (seconds)
# Important: Must be less than CI job timeout
CHECK_TIMEOUT=300

# ============================================
# CI PLATFORM-SPECIFIC EXAMPLES
# ============================================

# GitHub Actions Example:
# ======================
# - name: Run Shopify Monitor
#   env:
#     STORE_URL: ${{ secrets.STORE_URL }}
#     LLM_API_KEY: ${{ secrets.LLM_API_KEY }}
#     LLM_PROVIDER: openai
#     LLM_MODEL: gpt-3.5-turbo
#   run: nano-sre audit --url $STORE_URL

# GitLab CI Example:
# ==================
# shopify_monitor:
#   script:
#     - nano-sre audit --url $STORE_URL
#   variables:
#     LLM_PROVIDER: openai
#     LLM_MODEL: gpt-3.5-turbo
#   # STORE_URL and LLM_API_KEY set as CI/CD variables

# Jenkins Example:
# ================
# environment {
#     STORE_URL = credentials('shopify-store-url')
#     LLM_API_KEY = credentials('llm-api-key')
#     LLM_PROVIDER = 'openai'
#     LLM_MODEL = 'gpt-3.5-turbo'
# }

# CircleCI Example:
# =================
# - run:
#     name: Monitor Shopify Store
#     environment:
#       LLM_PROVIDER: openai
#       LLM_MODEL: gpt-3.5-turbo
#     command: nano-sre audit --url $STORE_URL

# ============================================
# CI/CD BEST PRACTICES
# ============================================

# 1. Secret Management:
#    - Never commit API keys
#    - Use CI platform's secret management
#    - Rotate secrets regularly
#    - Use separate keys per environment

# 2. Performance:
#    - Cache Playwright browsers between runs
#    - Use faster LLM models in CI
#    - Set appropriate timeouts
#    - Run checks in parallel when possible

# 3. Artifacts:
#    - Save audit reports as artifacts
#    - Include screenshots on failure
#    - Preserve traces for debugging
#    - Set artifact retention policies

# 4. Notifications:
#    - Alert on failures only (reduce noise)
#    - Include job/commit context
#    - Link to CI logs and artifacts
#    - Use appropriate urgency levels

# 5. Scheduling:
#    - Pre-deployment: Every commit/PR
#    - Post-deployment: After successful deploy
#    - Scheduled: Every 30-60 minutes
#    - Manual: On-demand via workflow_dispatch

# ============================================
# TROUBLESHOOTING
# ============================================

# CI Timeout Issues:
#   - Increase CHECK_TIMEOUT
#   - Use faster LLM model
#   - Reduce number of skills
#   - Check network connectivity

# Browser Issues:
#   - Ensure Playwright browsers installed
#   - Use chromium (most reliable in CI)
#   - Check for system dependencies
#   - Review headless mode settings

# API Rate Limits:
#   - Use separate API keys per environment
#   - Add delays between checks
#   - Monitor API usage
#   - Consider LLM request caching

# Memory Issues:
#   - Close browser between checks
#   - Limit concurrent skills
#   - Increase CI runner resources
#   - Check for memory leaks
